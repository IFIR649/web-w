<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Editar Estudiante - Lingus</title>
    <link rel="stylesheet" href="../../bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="../../css/Nunito.css">
    <link rel="stylesheet" href="../../fonts/fontawesome-all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="../../js/query.js"></script>
</head>

<body>
    <div id="navbar-placeholder"></div>
    <script>
        $(function () {
            $("#navbar-placeholder").load("../../navbar.html");
        });

        // Función para cargar datos desde el backend
        async function loadStudentData() {
            const urlParams = new URLSearchParams(window.location.search);
            const studentId = urlParams.get("id");

            if (!studentId) {
                alert("No se proporcionó un ID de estudiante.");
                window.location.href = "../students/index.html";
                return;
            }

            try {
                // Simulación de llamada al backend (reemplaza con fetch/axios en producción)
                const response = await fetch(`../../backend/get-student.php?id=${studentId}`);
                const studentData = await response.json();

                // Rellenar el formulario con los datos obtenidos
                document.getElementById("matricula").value = studentData.matricula;
                document.getElementById("nombre").value = studentData.nombre;
                document.getElementById("apellido_paterno").value = studentData.apellido_paterno;
                document.getElementById("apellido_materno").value = studentData.apellido_materno || "";
                document.getElementById("correo").value = studentData.correo || "";
                document.getElementById("estado").value = studentData.estado;
                document.getElementById("fecha_inscripcion").value = studentData.fecha_inscripcion;
                document.getElementById("num_alumno").value = studentData.num_alumno;
                document.getElementById("idioma").value = studentData.idioma_id || "";
            } catch (error) {
                alert("Error al cargar los datos del estudiante.");
                console.error(error);
                window.location.href = "../students/index.html";
            }
        }

        // Cargar datos al cargar la página
        window.onload = loadStudentData;
    </script>

    <div class="container mt-5">
        <h3 class="text-primary mb-4">Editar Estudiante</h3>
        <div class="card shadow">
            <div class="card-body">
                <form id="editStudentForm" action="../../backend/edit-student.php" method="POST">
                    <!-- Matrícula (Deshabilitada para edición) -->
                    <div class="mb-3">
                        <label for="matricula" class="form-label">Matrícula</label>
                        <input type="text" id="matricula" name="matricula" class="form-control" disabled>
                        <input type="hidden" id="hiddenMatricula" name="hiddenMatricula">
                    </div>

                    <!-- Nombre Completo -->
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" id="nombre" name="nombre" class="form-control" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="apellido_paterno" class="form-label">Apellido Paterno</label>
                            <input type="text" id="apellido_paterno" name="apellido_paterno" class="form-control" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="apellido_materno" class="form-label">Apellido Materno</label>
                            <input type="text" id="apellido_materno" name="apellido_materno" class="form-control">
                        </div>
                    </div>

                    <!-- Correo Electrónico -->
                    <div class="mb-3">
                        <label for="correo" class="form-label">Correo Electrónico</label>
                        <input type="email" id="correo" name="correo" class="form-control">
                    </div>

                    <!-- Estado -->
                    <div class="mb-3">
                        <label for="estado" class="form-label">Estado</label>
                        <select id="estado" name="estado" class="form-select" required>
                            <option value="activo">Activo</option>
                            <option value="inactivo">Inactivo</option>
                        </select>
                    </div>

                    <!-- Fecha de Inscripción -->
                    <div class="mb-3">
                        <label for="fecha_inscripcion" class="form-label">Fecha de Inscripción</label>
                        <input type="date" id="fecha_inscripcion" name="fecha_inscripcion" class="form-control" required>
                    </div>

                    <!-- Número de Alumno -->
                    <div class="mb-3">
                        <label for="num_alumno" class="form-label">Número de Alumno</label>
                        <input type="text" id="num_alumno" name="num_alumno" class="form-control" required>
                    </div>

                    <!-- Idioma -->
                    <div class="mb-3">
                        <label for="idioma" class="form-label">Idioma</label>
                        <select id="idioma" name="idioma" class="form-select">
                            <option value="">Seleccione un idioma</option>
                            <option value="1">Inglés</option>
                            <option value="2">Francés</option>
                            <option value="3">Alemán</option>
                        </select>
                    </div>

                    <!-- Botones -->
                    <div class="d-flex justify-content-between">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Cambios
                        </button>
                        <a href="../students/index.html" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="../../bootstrap/js/bootstrap.bundle.min.js"></script>
</body>

</html>
